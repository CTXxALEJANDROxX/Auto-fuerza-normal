local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Config
local PET_NAME = "Swift Samurai"
local ROCK_NAME = "Rock5M"
local PROTEIN_EGG_NAME = "ProteinEgg"
local PROTEIN_EGG_INTERVAL = 30 * 60
local REP_DELAY = 0.015 -- Delay entre cada rep individual (rápido sin disparar el ping)
local ROCK_INTERVAL = 5

getgenv()._AutoRepFarmEnabled = not getgenv()._AutoRepFarmEnabled
if not getgenv()._AutoRepFarmEnabled then
    warn("[Auto Rep Farm] DESACTIVADO")
    return
else
    warn("[Auto Rep Farm] ACTIVADO")
end

local HumanoidRootPart = nil
local hasSwiftSamurai = false
local lastProteinEggTime = 0
local lastRockTime = 0

local function updateCharacterRefs()
    local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    HumanoidRootPart = character:WaitForChild("HumanoidRootPart", 5)
end

local function equipPet()
    hasSwiftSamurai = false
    local petsFolder = LocalPlayer:FindFirstChild("petsFolder")
    if petsFolder and petsFolder:FindFirstChild("Unique") then
        for _, pet in pairs(petsFolder.Unique:GetChildren()) do
            if pet.Name == PET_NAME then
                ReplicatedStorage.rEvents.equipPetEvent:FireServer("equipPet", pet)
                hasSwiftSamurai = true
                break
            end
        end
    end
end

local function eatProteinEgg()
    if LocalPlayer:FindFirstChild("Backpack") then
        for _, item in pairs(LocalPlayer.Backpack:GetChildren()) do
            if item.Name == PROTEIN_EGG_NAME then
                ReplicatedStorage.rEvents.eatEvent:FireServer("eat", item)
                break
            end
        end
    end
end

local function hitRock()
    local rock = workspace:FindFirstChild(ROCK_NAME)
    if rock and HumanoidRootPart then
        HumanoidRootPart.CFrame = rock.CFrame * CFrame.new(0, 0, -5)
        ReplicatedStorage.rEvents.hitEvent:FireServer("hit", rock)
    end
end

-- Ejecutar reps continuas
task.spawn(function()
    updateCharacterRefs()
    equipPet()
    lastProteinEggTime = tick()

    while getgenv()._AutoRepFarmEnabled do
        -- Siempre enviar una rep
        if LocalPlayer:FindFirstChild("muscleEvent") then
            LocalPlayer.muscleEvent:FireServer("rep")
        end

        -- Comer huevo si toca
        if tick() - lastProteinEggTime >= PROTEIN_EGG_INTERVAL then
            eatProteinEgg()
            lastProteinEggTime = tick()
        end

        -- Golpear roca cada 5 segundos
        if tick() - lastRockTime >= ROCK_INTERVAL then
            hitRock()
            lastRockTime = tick()
        end

        -- Delay pequeño entre reps (ajústalo si sube ping)
        task.wait(REP_DELAY)
    end
end)
